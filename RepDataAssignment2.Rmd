---
title: 'Reproducible Research: Peer Assessment 2'
author: "jsalzwedel"
date: "05/20/2015"
output: 
    html_document:
        keep_md: true
---

# Synopsis
This analysis will explore the NOAA Storm Database to look at the health impacts
and economic consequences of of severe weather events.


# Data Processing

## Acquire and Read the Data
```{r, cache=TRUE}
url <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2"
download.file(url,"StormData.csv.bz2",method="wget")
system("bunzip2 StormData.csv.bz2")
```

Load relevant libraries
```{r}
library(data.table)
```

Read in the data
```{r, cache=TRUE}
data <- read.csv("StormData.csv")
data <- data.table(data)
```


## Cleaning

We are interested in the health and economic impacts of events. Let's subset the
relevant sections of the data: fatalities, injuries, property damage, and crop 
damage, along with the event type and the event reference number.  Rather than 
judge the relative severity of X fatalities vs Y injuries, let's combine both of 
those into one category called Casualties.  Likewise with the property and
crop damage.

```{r}
impact <- data.table(EventType = data$EVTYPE,
                     Casualties = data$FATALITIES + data$INJURIES,
                     Costs = data$PROPDMG + data$CROPDMG,
                     ReferenceNum = data$REFNUM)
```

There are a lot of events with the same event type but different capitalization
schemes (e.g. "HEAT WAVE" and "Heat Wave").  We can catch and clean up these
classification mismatches by making all the event types lower case.

```{r}
impact$EventType <- tolower(impact$EventType)
```

There are also a lot of events that are effective the same event type, but have
slightly different naming schemes (e.g. "thunderstorm wind", "tstm wind", and 
"thunderstormw").  We should try to catch these and simplify the categories.

```{r}
# Clean up naming variations
```

# Analysis

Let's find the event types where the most casualties occured.  Rather than look
at individual events, let's look at the average casualties for a given event
type.

```{r}
avgCasualties <- aggregate(x = list(AvgCasualties = impact$Casualties),
                           by = list(EventType = impact$EventType),
                           FUN = mean)
avgCasualties <- data.table(avgCasualties)
# Sort to list the event types with most casualties first, then remove event
# types that have no casualties
setorder(avgCasualties,-AvgCasualties)
avgCasualties <- avgCasualties[ which(avgCasualties$AvgCasualties > 0), ]
```



# Results









# Exploratory work
```{r}
with(data,plot(EVTYPE,FATALITIES))
avgFatalities <- aggregate(x = list(AvgFatalities = data$FATALITIES),
                           by=list(Event = data$EVTYPE),
                           FUN=mean)
avgFatalities <- data.table(avgFatalities)
setorder(avgFatalities,-AvgFatalities)
head(avgFatalities)
```

Let's take a closer look at the events where fatalities occured
```{r}
fatalData <- data[data$FATALITIES > 0,]
setorder(fatalData,-FATALITIES)
```


```{r}
avgInjuries <- aggregate(x = list(AvgInjuries = data$INJURIES),
                           by=list(Event = data$EVTYPE),
                           FUN=mean)
avgInjuries <- data.table(avgInjuries)
setorder(avgInjuries, -AvgInjuries)
head(avgInjuries,20)
```
